<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="PKHeX.MAUI.Views.InventoryEditorPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Inventory Editor">

    <Grid BackgroundColor="#F8F9FA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top Menu Bar -->
        <Grid Grid.Row="0" BackgroundColor="#2C3E50" Padding="15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <Button Grid.Column="0" Text="🔙 Back" Clicked="OnBackClicked" 
                    Margin="0,0,15,0" BackgroundColor="#34495E" TextColor="White" 
                    FontSize="14" FontAttributes="Bold" CornerRadius="8"/>
            <StackLayout Grid.Column="1" VerticalOptions="Center">
                <Label x:Name="HeaderLabel" Text="🎒 Inventory Editor" FontSize="20" FontAttributes="Bold" TextColor="White"/>
                <Label x:Name="GenerationLabel" Text="Generation: Unknown" FontSize="12" TextColor="#BDC3C7"/>
            </StackLayout>
            <Button Grid.Column="2" Text="💾 Save" Clicked="OnSaveClicked" 
                    BackgroundColor="#27AE60" TextColor="White" 
                    FontSize="14" FontAttributes="Bold" CornerRadius="8"/>
        </Grid>

        <!-- Main Content -->
        <ScrollView Grid.Row="1" Padding="20">
            <StackLayout Spacing="20">
                <!-- Pouch Selection Card -->
                <Frame BackgroundColor="White" Padding="20" CornerRadius="12">
                    <StackLayout>
                        <Label Text="📦 Select Pouch" FontSize="16" FontAttributes="Bold" TextColor="#2C3E50" Margin="0,0,0,10"/>
                        <ScrollView Orientation="Horizontal" BackgroundColor="#F8F9FA" HeightRequest="80" Padding="8,4">
                            <StackLayout x:Name="PouchContainer" Orientation="Horizontal" Spacing="12" Padding="4,8"/>
                        </ScrollView>
                    </StackLayout>
                </Frame>

                <!-- Current Pouch Info Card -->
                <Frame BackgroundColor="#3498DB" Padding="20" CornerRadius="12" 
                       x:Name="PouchInfoFrame" IsVisible="False">
                    <StackLayout>
                        <Label x:Name="PouchNameLabel" Text="Pouch: None" FontSize="16" FontAttributes="Bold" TextColor="White"/>
                        <Label x:Name="PouchStatsLabel" Text="Items: 0/0" FontSize="14" TextColor="#EBF5FF"/>
                    </StackLayout>
                </Frame>

                <!-- Tools Card -->
                <Frame BackgroundColor="White" Padding="20" CornerRadius="12" 
                       x:Name="ToolsFrame" IsVisible="False">
                    <StackLayout>
                        <Label Text="🛠️ Tools" FontSize="16" FontAttributes="Bold" TextColor="#2C3E50" Margin="0,0,0,15"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Button Grid.Row="0" Grid.Column="0" Text="⬆️ Max All" Clicked="OnMaxAllClicked" 
                                    Margin="0,0,8,8" BackgroundColor="#27AE60" TextColor="White" 
                                    FontSize="14" FontAttributes="Bold" CornerRadius="8" HeightRequest="45"/>
                            <Button Grid.Row="0" Grid.Column="1" Text="🗑️ Clear All" Clicked="OnClearAllClicked" 
                                    Margin="8,0,0,8" BackgroundColor="#E74C3C" TextColor="White" 
                                    FontSize="14" FontAttributes="Bold" CornerRadius="8" HeightRequest="45"/>
                            <Button Grid.Row="1" Grid.Column="0" Text="⚖️ Give All Legal" Clicked="OnGiveAllLegalClicked" 
                                    Margin="0,8,8,0" BackgroundColor="#9B59B6" TextColor="White" 
                                    FontSize="14" FontAttributes="Bold" CornerRadius="8" HeightRequest="45"/>
                            <Button Grid.Row="1" Grid.Column="1" Text="🔢 Sort by ID" Clicked="OnSortByIndexClicked" 
                                    Margin="8,8,0,0" BackgroundColor="#34495E" TextColor="White" 
                                    FontSize="14" FontAttributes="Bold" CornerRadius="8" HeightRequest="45"/>
                        </Grid>
                    </StackLayout>
                </Frame>

                <!-- Items List Card with Popup Button -->
                <Frame BackgroundColor="White" Padding="20" CornerRadius="12" 
                       x:Name="ItemsFrame" IsVisible="False">
                    <StackLayout>
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Label Grid.Column="0" Text="📋 Items" FontSize="16" FontAttributes="Bold" TextColor="#2C3E50" VerticalOptions="Center"/>
                            <Button Grid.Column="1" Text="🔍 Full View" Clicked="OnFullViewClicked" 
                                    BackgroundColor="#3498DB" TextColor="White" 
                                    FontSize="12" FontAttributes="Bold" CornerRadius="6" 
                                    HeightRequest="35" WidthRequest="100"/>
                        </Grid>
                        <!-- Items preview (showing first few items) -->
                        <StackLayout x:Name="ItemsContainer" Spacing="12"/>
                        <Label x:Name="ItemsPreviewLabel" Text="Showing first 5 items. Click 'Full View' to see all items." 
                               FontSize="12" FontAttributes="Italic" TextColor="#7F8C8D" 
                               HorizontalOptions="Center" Margin="0,10,0,0" IsVisible="False"/>
                    </StackLayout>
                </Frame>
            </StackLayout>
        </ScrollView>

        <!-- Full-Screen Items Popup Modal -->
        <Grid x:Name="ItemsPopupOverlay" BackgroundColor="#90000000" IsVisible="False" Grid.RowSpan="2">
            <Frame BackgroundColor="White" Margin="30" CornerRadius="12" Padding="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Enhanced Popup Header -->
                    <Grid Grid.Row="0" BackgroundColor="#2C3E50" Padding="20,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackLayout Grid.Column="0" VerticalOptions="Center">
                            <Label x:Name="PopupPouchNameLabel" Text="📋 All Items - Full View" 
                                   FontSize="20" FontAttributes="Bold" TextColor="White"/>
                            <Label x:Name="PopupPouchStatsLabel" Text="Items: 0/0 • Max Count: 999" 
                                   FontSize="13" TextColor="#BDC3C7" Margin="0,2,0,0"/>
                        </StackLayout>
                        
                        <Button Grid.Column="1" Text="✕" Clicked="OnClosePopupClicked" 
                                BackgroundColor="#E74C3C" TextColor="White" 
                                FontSize="18" FontAttributes="Bold" CornerRadius="22" 
                                WidthRequest="44" HeightRequest="44"
                                BorderWidth="0" Padding="0"/>
                    </Grid>

                    <!-- Enhanced Popup Content Area -->
                    <Grid Grid.Row="1" Padding="20" BackgroundColor="#F8F9FA">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Enhanced Search Bar -->
                        <Frame Grid.Row="0" BackgroundColor="White" Padding="16" CornerRadius="10" 
                               Margin="0,0,0,15" BorderColor="#E8E8E8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <Label Grid.Column="0" Text="🔍" FontSize="16" TextColor="#7F8C8D" 
                                       VerticalOptions="Center" Margin="0,0,10,0"/>
                                
                                <Entry Grid.Column="1" x:Name="SearchEntry" 
                                       Placeholder="Search items by name or ID..." 
                                       FontSize="14" TextChanged="OnSearchTextChanged"
                                       BackgroundColor="Transparent"
                                       TextColor="#2C3E50" PlaceholderColor="#7F8C8D"/>
                                
                                <Button Grid.Column="2" Text="➕" FontSize="14" 
                                        BackgroundColor="#27AE60" TextColor="White"
                                        CornerRadius="15" WidthRequest="30" HeightRequest="30"
                                        Clicked="OnAddNewItemClicked" Padding="0"
                                        ToolTipProperties.Text="Add New Item"/>
                            </Grid>
                        </Frame>

                        <!-- Scrollable Items List with Better Styling -->
                        <ScrollView Grid.Row="1" BackgroundColor="Transparent">
                            <StackLayout x:Name="PopupItemsContainer" Spacing="4"/>
                        </ScrollView>
                    </Grid>

                    <!-- Enhanced Popup Footer -->
                    <Grid Grid.Row="2" BackgroundColor="#34495E" Padding="20,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button Grid.Column="0" Text="⬆️ Max All" Clicked="OnMaxAllClicked" 
                                Margin="0,0,8,0" BackgroundColor="#27AE60" TextColor="White" 
                                FontSize="13" FontAttributes="Bold" CornerRadius="8" HeightRequest="42"/>
                        <Button Grid.Column="1" Text="🗑️ Clear All" Clicked="OnClearAllClicked" 
                                Margin="4,0,4,0" BackgroundColor="#E74C3C" TextColor="White" 
                                FontSize="13" FontAttributes="Bold" CornerRadius="8" HeightRequest="42"/>
                        <Button Grid.Column="2" Text="⚖️ Legal" Clicked="OnGiveAllLegalClicked" 
                                Margin="4,0,4,0" BackgroundColor="#9B59B6" TextColor="White" 
                                FontSize="13" FontAttributes="Bold" CornerRadius="8" HeightRequest="42"/>
                        <Button Grid.Column="3" Text="💾 Save" Clicked="OnSaveFromPopupClicked" 
                                Margin="8,0,0,0" BackgroundColor="#3498DB" TextColor="White" 
                                FontSize="13" FontAttributes="Bold" CornerRadius="8" HeightRequest="42"/>
                    </Grid>
                </Grid>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>
