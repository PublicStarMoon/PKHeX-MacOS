# 听话等级功能实现说明

## 功能概述
在PKHeX-MacOS的宝可梦编辑器中添加了第九代专属的"听话等级"（Obedience Level）编辑功能。

## 实现的功能

### 1. 界面显示
- 在"Origin & Met Information"部分添加了听话等级输入框
- 标签显示为"听话等级:"，占位符为"0-100"
- 只有在编辑第九代宝可梦时才会显示该功能
- 非第九代宝可梦会自动隐藏该输入框和标签

### 2. 数据加载
- 在`LoadPokemonData()`方法中检测宝可梦的世代（`_pokemon.Format == 9`）
- 如果是第九代且宝可梦实现了`IObedienceLevel`接口，则加载`Obedience_Level`属性值
- 如果是第九代但未实现接口，则显示默认值0

### 3. 数据保存
- 在`OnObedienceLevelChanged`事件处理器中实时保存用户输入
- 验证输入值必须在0-100范围内
- 只有第九代宝可梦才能修改此值

## 技术实现细节

### 修改的文件

#### 1. PokemonEditorPage.xaml
- 在Grid中添加了新的行定义
- 添加了`ObedienceLevelLabel`和`ObedienceLevelEntry`控件
- 设置了相应的Grid位置和样式

#### 2. PokemonEditorPage.xaml.cs
- 在`LoadPokemonData()`方法中添加了听话等级的加载逻辑
- 实现了世代检测和控件可见性控制
- 添加了`OnObedienceLevelChanged`事件处理方法
- 实现了数据验证和保存逻辑

### 关键代码逻辑

```csharp
// 世代检测和控件可见性控制
bool isGen9 = _pokemon.Format == 9;
ObedienceLevelLabel.IsVisible = isGen9;
ObedienceLevelEntry.IsVisible = isGen9;

// 数据加载
if (isGen9 && _pokemon is IObedienceLevel obediencePokemon)
{
    ObedienceLevelEntry.Text = obediencePokemon.Obedience_Level.ToString();
}

// 数据保存和验证
if (_pokemon.Format == 9 && _pokemon is IObedienceLevel obediencePokemon)
{
    if (byte.TryParse(e.NewTextValue, out byte obedienceLevel) && 
        obedienceLevel >= 0 && obedienceLevel <= 100)
    {
        obediencePokemon.Obedience_Level = obedienceLevel;
    }
}
```

## 用户体验

### 第九代宝可梦
- 用户可以看到"听话等级"输入框
- 可以输入0-100范围内的数值
- 输入会实时保存到宝可梦数据中

### 非第九代宝可梦
- "听话等级"相关控件完全隐藏
- 界面保持整洁，不显示无关功能

## 测试建议
1. 加载第九代宝可梦存档，验证听话等级是否正确显示和可编辑
2. 加载其他世代宝可梦存档，验证听话等级控件是否正确隐藏
3. 测试输入边界值（0, 100）和无效值，确保数据验证正常工作
4. 保存编辑后的宝可梦，确认听话等级值正确保存

## 构建状态
✅ 构建成功 - 所有修改已通过编译验证
